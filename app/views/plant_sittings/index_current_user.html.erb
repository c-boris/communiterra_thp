<div class="grid xs:grid-cols-1 my-5 mx-5">
  <div class="p-4">
    <%= link_to "Ajouter des plantes à garder", new_kept_plant_path, class: "p-4 text-indigo-500 font-semibold" %>
    <%= link_to "Mes demandes de garde", kept_plants_path, class: "p-4 text-indigo-500 font-semibold" %>
    <%= link_to "Mes gardes de plantes", index_current_user_plant_sittings_path, class: "p-4 text-indigo-500 font-semibold" %>
  </div>
  <div class="bg-white rounded-lg shadow-md p-4">
    <h2 class="font-semibold text-xl">Plant Sittings en tant que Sitter :</h2>
    <% @plant_sittings_as_sitter.each do |plant_sitting| %>
      <div class="p-4 border rounded-lg mb-4">
        <% plant_sitting.kept_plants.group_by { |kept_plant| kept_plant.start_date }.each do |start_date, plants| %>
          <% end_date = plants.first.end_date %>
          <h2 class="font-semibold text-lg">
            <br><strong>Demande de garde du <%= l(start_date.to_date, format: "%-d %B %Y") %> au <%= l(end_date.to_date, format: "%-d %B %Y") %></strong>
          </h2>
          
          <% plants.each do |kept_plant| %>
            <h2 class="font-semibold text-lg">
              <br><strong>Nom de la plante :</strong> <%= kept_plant.owned_plant.plant.common_name %>
            </h2>
            
            <p class="mb-2">
              <strong>Quantité :</strong> <%= kept_plant.quantity %>
            </p>
            
            <p class="mb-2">
              <%= kept_plant.description %>
            </p>
            
            <div class="mt-2">
              <%= link_to "Plus de détails sur cette plante", kept_plant_path(kept_plant) %>
              <% if current_user == kept_plant.owned_plant.user %>
                <%= link_to "Éditer la plante à garder", edit_kept_plant_path(kept_plant) %>
                <%= button_to "Supprimer la plante à garder", kept_plant, method: :delete %>
              <% end %>
            </div>
          <% end %>

            <p>
              <br><strong>PlantAsker :</strong> <%= plants.first.plant_sitting.asker.username %>
            </p>
          
          <% if current_user == plants.first.owned_plant.user %>
            <div class="mt-4">
              <%= button_to "Supprimer la demande de garde", kept_plants_path(kept_plant_ids: plants.map(&:id)), method: :delete, data: { confirm: "Êtes-vous sûr de vouloir supprimer cette demande de garde et toutes les plantes associées ?" }, class: "text-red-500 font-semibold" %>
            </div>
          <% end %>
        <% end %>
      </div>
    <% end %>
    
    <% if @plant_sittings_as_sitter.empty? %>
      <p>Aucun plant sitting en tant que Sitter.</p>
    <% end %>
  </div>
</div>
